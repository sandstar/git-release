#!/usr/bin/env node

var program = require('commander');
var release = require('..');
var pkg = require('../package');
var gitflowRelease = require('../lib/gitflowRelease');
var util = require('../lib/util');


program
  .version(pkg.version)
  .usage('files...')
  .option('-f, --force <version>', 'force a specific version (<newversion> | major | minor | patch)')
  .option('-p, --parent', 'also update parent version (Maven only)')
    .option('-d --distinct <pnumber>', 'distinct patch number for develop branch (git-flow only)')
  .parse(process.argv);

var files = program.args.length > 0 && program.args;

function workflowCallback(found) {
  var releaseFunction;
  if (found === 'gitflow')
    releaseFunction = gitflowRelease;
  else
    releaseFunction = release;

  releaseFunction(program.force, files, program.parent, program.distinct, function(err) {
    if (err) {
      console.error(err.message);
      process.exit(1);
    } else {
      process.exit();
    }
  });
}

util.recognizeWorkflow(workflowCallback);


